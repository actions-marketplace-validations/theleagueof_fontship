#!/usr/bin/env @PYTHON@

__version__ = "@VERSION@"

# This is inscruitable, but basically allows us to take advantage of automake
# knowing where system stuff is without having to process the source in two
# stages to get the final answer here. All this to know where on the system we
# are currently installed!
SRCDIR = "@datarootdir@/fontship/".replace("${prefix}", "@prefix@")

import sys
sys.path.append("@pythondir@/".replace("${prefix}", "@prefix@"))

import click
import fontship
import subprocess

@click.group()
@click.version_option(__version__)
def fontship():
    """Execute any fontship supported subcommand COMMAND."""

@click.command()
@click.pass_context
@click.argument('target', nargs=-1)
def make(ctx, target):
    """Build specified target(s)."""
    # TODO: Check if a local Makefile exists first, and run it with an extra include if so
    process = subprocess.run(['make', '-f', SRCDIR + "rules.mk"] + list(target))
    #, stdout=subprocess.PIPE, stderr=subprocess.PIPE, universal_newlines=True)
    process

fontship.add_command(make)

@click.command()
@click.pass_context
def status(ctx):
    """Show information about setup and build status."""
    click.echo("No what?")

fontship.add_command(status)

if __name__ == '__main__':
    fontship()

# vim: ft=python
